<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; padding: 20px; background-color: #f8f8f8; }
        h1, h2 { color: #333; }
        label { display: float; margin: 10px 0 5px; }
        input { margin-bottom: 10px; padding: 10px; width: 70px; }
        button { padding: 7px 16px; font-size: 16px; color: white; background-color: #245353; border: none; border-radius: 10px; cursor: pointer; }
        button:hover { background-color: #183a3a; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 5px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #245353; color: white; }
        .delete-button { font-size: 10px; background-color: #c5342a; }
        .delete-button:hover { font-size: 8px; background-color: #881e1e; }
    </style>
</head>
<body style="display: grid; place-content: center; height: 100vh; margin: 0;">
        
    
    <h1 style="text-align: center;">${{ total_spending}}</h1>
    <!-- <h2>Total Spending for This Month: $<span id="totalSpending">{{ total_spending }}</span></h2> -->

    <form id="addSpendingForm">
        <label for="amount">Enter Amount:</label>
        <input type="number" id="amount" name="amount" step="0.01" required>
        <button type="submit">Add Amount</button>
    </form>

    <h3>Spending Entries for This Month</h3>
    <table id="spendingTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in spending_entries %}
                <tr data-id="{{ entry.id }}">
                    <td>{{ entry.id }}</td>
                    <td>${{ entry.amount }}</td>
                    <td>{{ entry.date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td><button class="delete-button" onclick="confirmDelete({{ entry.id }})">Delete</button></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Handle form submission for adding a spending entry
        document.getElementById('addSpendingForm').onsubmit = async function (e) {
            e.preventDefault();
            const amount = document.getElementById('amount').value;
            const data = { amount: parseFloat(amount) };

            const response = await fetch('/add_spending', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert('Spending entry added successfully!');
                location.reload();  // Reload page to update total and entries
            } else {
                alert('Failed to add spending entry.');
            }
        };

        // Function to confirm deletion before proceeding
        async function confirmDelete(id) {
            const confirmed = confirm("Are you sure you want to delete this spending entry?");
            if (!confirmed) {
                return;  // Exit if user cancels
            }

            // Proceed with delete if confirmed
            const response = await fetch(`/delete_spending/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert('Spending entry deleted successfully!');
                document.querySelector(`tr[data-id="${id}"]`).remove(); // Remove row from table
                location.reload();  // Reload page to update total and entries
            } else {
                alert('Failed to delete spending entry.');
            }
        }
    </script>
</body>
</html>
